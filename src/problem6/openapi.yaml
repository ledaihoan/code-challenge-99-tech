openapi: 3.0.3
info:
  title: Live Scoreboard API
  version: 1.0.0
  description: Real-time leaderboard system with fraud prevention

servers:
  - url: https://api.example.com/v1
    description: Production server

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      summary: User authentication
      tags: [Authentication]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials

  /actions/start:
    post:
      summary: Start an action attempt
      tags: [Actions]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [actionId]
              properties:
                actionId:
                  type: string
                  format: uuid
                clientFingerprint:
                  type: string
      responses:
        '201':
          description: Action attempt created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionAttempt'
        '400':
          description: Invalid request
        '429':
          description: Rate limit exceeded

  /actions/complete:
    post:
      summary: Complete an action and award points
      tags: [Actions]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [attemptId]
              properties:
                attemptId:
                  type: string
                  format: uuid
                clientFingerprint:
                  type: string
      responses:
        '200':
          description: Action completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  pointsAwarded:
                    type: integer
                  newTotalScore:
                    type: integer
                  leaderboardPosition:
                    type: integer
                    nullable: true
        '403':
          description: Validation failed or fraud detected
        '404':
          description: Attempt not found
        '409':
          description: Action already completed or points depleted

  /actions:
    get:
      summary: List available actions
      tags: [Actions]
      responses:
        '200':
          description: List of actions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Action'

  /leaderboard/top10:
    get:
      summary: Get top 10 users by score
      tags: [Leaderboard]
      security: []
      responses:
        '200':
          description: Top 10 leaderboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      type: object
                      properties:
                        rank:
                          type: integer
                        userId:
                          type: string
                          format: uuid
                        firstName:
                          type: string
                        lastName:
                          type: string
                        score:
                          type: integer
                  lastUpdated:
                    type: string
                    format: date-time

  /users/me:
    get:
      summary: Get current user profile
      tags: [Users]
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/User'
                  - type: object
                    properties:
                      leaderboardPosition:
                        type: integer
                        nullable: true

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        currentScore:
          type: integer
        createdAt:
          type: string
          format: date-time

    Action:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        pointsPerCompletion:
          type: integer
        totalPointsPool:
          type: integer
        remainingPoints:
          type: integer
        minCompletionTime:
          type: integer
          description: Minimum seconds to complete
        maxCompletionTime:
          type: integer
          description: Maximum seconds to complete
        cooldownSeconds:
          type: integer
          description: Cooldown period before user can retry same action
          default: 300
        isActive:
          type: boolean

    ActionAttempt:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        actionId:
          type: string
          format: uuid
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
          nullable: true
        pointsAwarded:
          type: integer
          nullable: true
        status:
          type: string
          enum: [started, completed, failed, expired]
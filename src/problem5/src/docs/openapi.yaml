openapi: 3.0.1
info:
  title: Blog API
  version: 1.0.0
  description: RESTful APIs for blog system with full-text search

servers:
  - url: http://localhost:5000/api
    description: Development server

tags:
  - name: Auth
    description: Authentication endpoints
  - name: User
    description: User profile management
  - name: Posts
    description: Post management (user-specific)
  - name: Public
    description: Public endpoints

paths:
  /v1/auth/sign-in:
    post:
      tags:
        - Auth
      summary: Sign in user
      description: Authenticate user with email and password. Sets httpOnly cookie with refresh token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: password123
      responses:
        '200':
          description: Successfully authenticated
          headers:
            Set-Cookie:
              schema:
                type: string
                example: refreshToken=abc123; HttpOnly; Secure; SameSite=Strict
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: JWT access token (expires in 15 minutes)
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/auth/refresh:
    post:
      tags:
        - Auth
      summary: Refresh access token
      description: Get new access token using refresh token from httpOnly cookie
      responses:
        '200':
          description: New access token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/auth/sign-out:
    post:
      tags:
        - Auth
      summary: Sign out user
      description: Invalidate refresh token and clear httpOnly cookie
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Successfully signed out
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/users/profile:
    get:
      tags:
        - User
      summary: Get user profile
      description: Retrieve authenticated user's profile information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      tags:
        - User
      summary: Update user profile
      description: Update authenticated user's profile information
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: John
                lastName:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: Doe
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/users/{userId}/posts:
    post:
      tags:
        - Posts
      summary: Create a post
      description: Create a new post for authenticated user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (must match authenticated user)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
                - body
                - categoryId
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 255
                  example: Getting Started with TypeScript
                description:
                  type: string
                  minLength: 1
                  example: Learn the fundamentals of TypeScript
                body:
                  type: string
                  minLength: 1
                  example: TypeScript has become an essential tool...
                tags:
                  type: array
                  items:
                    type: string
                  default: []
                  example: ["typescript", "programming"]
                categoryId:
                  type: integer
                  example: 1
      responses:
        '201':
          description: Post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/users/{userId}/posts/{id}:
    get:
      tags:
        - Posts
      summary: Get post by ID
      description: Retrieve a specific post by ID (must belong to authenticated user)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Post ID (bigint)
      responses:
        '200':
          description: Post details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    patch:
      tags:
        - Posts
      summary: Update post
      description: Update an existing post (must belong to authenticated user)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Post ID (bigint)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 255
                description:
                  type: string
                  minLength: 1
                body:
                  type: string
                  minLength: 1
                tags:
                  type: array
                  items:
                    type: string
                categoryId:
                  type: integer
      responses:
        '200':
          description: Post updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Posts
      summary: Delete post
      description: Delete a post (must belong to authenticated user)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Post ID (bigint)
      responses:
        '204':
          description: Post deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/users/{userId}/posts/search:
    post:
      tags:
        - Posts
      summary: Search user's posts
      description: Search posts for a specific user with cursor pagination
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
            format: uuid
          description: User ID
        - in: query
          name: cursor
          schema:
            type: string
          description: Cursor for pagination (base64 encoded)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 10
          description: Number of results per page
        - in: query
          name: sortBy
          schema:
            type: string
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
          description: Sort order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                searchText:
                  type: string
                  example: typescript programming
                categoryIds:
                  type: array
                  items:
                    type: integer
                  example: [1, 2]
      responses:
        '200':
          description: Search results with cursor pagination
          content:
            application/json:
              schema:
                type: object
                properties:
                  nextCursor:
                    type: string
                    nullable: true
                    description: Cursor for next page (null if no more pages)
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/public/posts/search:
    post:
      tags:
        - Public
      summary: Search all posts (public)
      description: Search all posts with full-text search and cursor pagination (public endpoint)
      parameters:
        - in: query
          name: cursor
          schema:
            type: string
          description: Cursor for pagination (base64 encoded)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 10
          description: Number of results per page
        - in: query
          name: sortBy
          schema:
            type: string
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
          description: Sort order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                authorIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  example: ["dd42bf05-f534-46ba-9af6-1dc681c3c5a3"]
                searchText:
                  type: string
                  example: typescript programming tutorial
                categoryIds:
                  type: array
                  items:
                    type: integer
                  example: [1, 2, 3]
      responses:
        '200':
          description: Search results with cursor pagination
          content:
            application/json:
              schema:
                type: object
                properties:
                  nextCursor:
                    type: string
                    nullable: true
                    description: Cursor for next page (null if no more pages)
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: dd42bf05-f534-46ba-9af6-1dc681c3c5a3
        email:
          type: string
          format: email
          example: john.doe@example.com
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Category:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Technology
        fullPathName:
          type: string
          example: Technology > Programming
        slug:
          type: string
          example: technology/programming
        parentId:
          type: integer
          nullable: true
          example: null

    Post:
      type: object
      properties:
        id:
          type: string
          example: "12345"
          description: BigInt as string
        userId:
          type: string
          format: uuid
          example: dd42bf05-f534-46ba-9af6-1dc681c3c5a3
        categoryId:
          type: integer
          example: 1
        title:
          type: string
          example: Getting Started with TypeScript
        description:
          type: string
          example: Learn the fundamentals of TypeScript
        body:
          type: string
          example: TypeScript has become an essential tool...
        tags:
          type: array
          items:
            type: string
          example: ["typescript", "javascript", "programming"]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        category:
          $ref: '#/components/schemas/Category'
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
            firstName:
              type: string
            lastName:
              type: string

    Error:
      type: object
      properties:
        error:
          type: string
          example: UNAUTHORIZED
        message:
          type: string
          example: Invalid credentials
        statusCode:
          type: integer
          example: 401